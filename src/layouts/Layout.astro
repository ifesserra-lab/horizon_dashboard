---
interface Props {
	title: string;
	breadcrumbReplacements?: Record<string, string>;
}

const { title, breadcrumbReplacements } = Astro.props;
import '../styles/global.css';
import ThemeToggle from '../components/ThemeToggle.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
---

<!doctype html>
<html lang="pt-BR" class="dark">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content="Horizon - Portal de Pesquisa, Extensão e Pós-Graduação" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href={`${import.meta.env.BASE_URL}favicon.svg`} />
		<meta name="generator" content={Astro.generator} />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
		<title>{title} | Horizon</title>
		
		<script is:inline>
			const theme = (() => {
				if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
					return localStorage.getItem('theme');
				}
				if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
					return 'dark';
				}
				return 'light';
			})();
			
			if (theme === 'light') {
				document.documentElement.classList.remove('dark');
			} else {
				document.documentElement.classList.add('dark');
			}
			window.localStorage.setItem('theme', theme);
		</script>
	</head>
	<body class="bg-page-bg text-text-main font-['Inter'] min-h-screen selection:bg-premium-accent/30 transition-colors duration-300">
		<a href={`#main-content`} class="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-premium-accent focus:text-white rounded-br-xl shadow-xl">
			Pular para o conteúdo principal
		</a>

		<div class="flex flex-col md:flex-row min-h-screen">
			<!-- Mobile Header -->
			<header class="md:hidden h-16 glass-card rounded-none border-x-0 border-t-0 flex items-center justify-between px-6 z-30 sticky top-0">
				<div class="flex items-center gap-3">
					<div class="w-8 h-8 bg-gradient-to-br from-premium-accent to-premium-purple rounded-lg shadow-lg flex items-center justify-center overflow-hidden" aria-hidden="true">
						<span class="text-white font-['Outfit'] font-bold text-lg">H</span>
					</div>
					<h1 class="text-lg font-['Outfit'] font-bold bg-clip-text text-transparent bg-gradient-to-r from-text-main to-slate-400">Horizon</h1>
				</div>
				<div class="flex items-center gap-4">
					<ThemeToggle />
					<label for="mobile-menu-toggle" class="p-2 hover:bg-premium-accent/10 rounded-lg transition-colors cursor-pointer" aria-label="Abrir menu">
						<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
						</svg>
					</label>
				</div>
			</header>

			<!-- Mobile Menu Toggle (Checkbox Hack) -->
			<input type="checkbox" id="mobile-menu-toggle" class="hidden peer" />
			
			<!-- Mobile Backdrop -->
			<label 
				for="mobile-menu-toggle" 
				class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 transition-opacity duration-300 opacity-0 invisible peer-checked:opacity-100 peer-checked:visible md:hidden" 
				aria-hidden="true"
			></label>

			<!-- Mobile Sidebar / Drawer -->
			<aside class="fixed inset-y-0 left-0 w-72 glass-card rounded-none border-y-0 border-l-0 flex flex-col p-6 z-50 transform -translate-x-full transition-transform duration-300 ease-in-out peer-checked:translate-x-0 md:hidden shadow-2xl">
				<div class="flex items-center justify-between mb-12">
					<div class="flex items-center gap-3">
						<div class="w-10 h-10 bg-gradient-to-br from-premium-accent to-premium-purple rounded-xl shadow-lg flex items-center justify-center overflow-hidden" aria-hidden="true">
							<span class="text-white font-['Outfit'] font-bold text-xl">H</span>
						</div>
						<span class="text-xl font-['Outfit'] font-bold text-text-main">Horizon</span>
					</div>
					<label for="mobile-menu-toggle" class="p-2 hover:bg-premium-accent/10 rounded-lg transition-colors cursor-pointer">
						<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
						</svg>
					</label>
				</div>

				<nav role="navigation" aria-label="Menu mobile" class="flex-1 flex flex-col gap-2">
					<a href={`${import.meta.env.BASE_URL}`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
						<span class="font-medium">Dashboard</span>
					</a>
					<a href={`${import.meta.env.BASE_URL}groups`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
						<span class="font-medium">Grupos</span>
					</a>
					<a href={`${import.meta.env.BASE_URL}knowledge-areas`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
						<span class="font-medium">Áreas</span>
					</a>
					<a href={`${import.meta.env.BASE_URL}projects`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A5 5 0 0 0 8 8c0 1.3.5 2.6 1.5 3.5.8.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>
						<span class="font-medium">Projetos</span>
					</a>
					<a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group opacity-50 cursor-not-allowed" aria-disabled="true">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
						<span class="font-medium">Publicações</span>
					</a>
				</nav>


			</aside>

			<!-- Desktop Sidebar -->
			<aside id="desktop-sidebar" class="group/sidebar hidden md:flex w-64 h-screen sticky top-0 glass-card rounded-none border-y-0 border-l-0 flex-col overflow-hidden transition-all duration-300 ease-in-out data-[collapsed=true]:w-20 p-6">
				<div class="flex items-center gap-3 mb-12 justify-center transition-all duration-300 group-data-[collapsed=true]/sidebar:mb-6">
					<div class="flex items-center gap-3 group-data-[collapsed=true]/sidebar:justify-center">
						<div class="w-10 h-10 bg-gradient-to-br from-premium-accent to-premium-purple rounded-xl shadow-lg shadow-premium-accent/20 flex items-center justify-center overflow-hidden flex-shrink-0" aria-hidden="true">
							<span class="text-white font-['Outfit'] font-bold text-xl">H</span>
						</div>
						<span class="text-xl font-['Outfit'] font-bold bg-clip-text text-transparent bg-gradient-to-r from-text-main to-slate-400 opacity-100 transition-all duration-300 group-data-[collapsed=true]/sidebar:w-0 group-data-[collapsed=true]/sidebar:opacity-0 group-data-[collapsed=true]/sidebar:overflow-hidden whitespace-nowrap">Horizon</span>
					</div>
				</div>

				<nav role="navigation" aria-label="Menu principal" class="flex-1 flex flex-col gap-2 min-w-max">
					<a href={`${import.meta.env.BASE_URL}`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
						<span class="font-medium whitespace-nowrap opacity-100 transition-opacity duration-300 group-data-[collapsed=true]/sidebar:opacity-0 group-data-[collapsed=true]/sidebar:invisible group-data-[collapsed=true]/sidebar:w-0">Dashboard</span>
					</a>
					<a href={`${import.meta.env.BASE_URL}groups`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
						<span class="font-medium whitespace-nowrap opacity-100 transition-opacity duration-300 group-data-[collapsed=true]/sidebar:opacity-0 group-data-[collapsed=true]/sidebar:invisible group-data-[collapsed=true]/sidebar:w-0">Grupos</span>
					</a>
					<a href={`${import.meta.env.BASE_URL}knowledge-areas`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
						<span class="font-medium whitespace-nowrap opacity-100 transition-opacity duration-300 group-data-[collapsed=true]/sidebar:opacity-0 group-data-[collapsed=true]/sidebar:invisible group-data-[collapsed=true]/sidebar:w-0">Áreas</span>
					</a>
					<a href={`${import.meta.env.BASE_URL}projects`} class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A5 5 0 0 0 8 8c0 1.3.5 2.6 1.5 3.5.8.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>
						<span class="font-medium whitespace-nowrap opacity-100 transition-opacity duration-300 group-data-[collapsed=true]/sidebar:opacity-0 group-data-[collapsed=true]/sidebar:invisible group-data-[collapsed=true]/sidebar:w-0">Projetos</span>
					</a>
					<a href="#" class="flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-premium-accent/10 hover:text-premium-accent group opacity-50 cursor-not-allowed" aria-disabled="true">
						<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 opacity-70 group-hover:opacity-100 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
						<span class="font-medium whitespace-nowrap opacity-100 transition-opacity duration-300 group-data-[collapsed=true]/sidebar:opacity-0 group-data-[collapsed=true]/sidebar:invisible group-data-[collapsed=true]/sidebar:w-0">Publicações</span>
					</a>
				</nav>


				<div class="mt-auto pt-6 border-t border-border-main flex justify-center">
					<button id="sidebar-toggle" class="p-2 w-full flex items-center justify-center rounded-lg text-text-secondary hover:bg-premium-accent/10 hover:text-premium-accent transition-colors group" aria-label="Recolher menu lateral" title="Recolher menu lateral">
						<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 flex-shrink-0 transition-transform duration-300 group-data-[collapsed=true]/sidebar:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7" />
						</svg>
						<span class="ml-3 font-medium opacity-100 transition-opacity duration-300 group-data-[collapsed=true]/sidebar:hidden whitespace-nowrap overflow-hidden w-auto group-data-[collapsed=true]/sidebar:w-0">Recolher</span>
					</button>
				</div>
			</aside>

			<!-- Main Content -->
			<div class="flex-1 flex flex-col h-screen overflow-hidden">
				<header role="banner" class="hidden md:flex h-16 border-b border-border-main glass-card rounded-none border-x-0 items-center justify-end px-8 z-10 transition-[padding] duration-300">
					<ThemeToggle />
				</header>
				<main id="main-content" role="main" class="flex-1 p-4 md:p-8 overflow-y-auto outline-none">
					<div class="max-w-7xl mx-auto">
						<Breadcrumbs replacements={breadcrumbReplacements} />
						<slot />
					</div>
				</main>
			</div>
		</div>
		
		<script is:inline>
			// Desktop Sidebar Toggle Logic
			const sidebar = document.getElementById('desktop-sidebar');
			const sidebarToggle = document.getElementById('sidebar-toggle');
			const STORAGE_KEY = 'sidebar-collapsed';

			// Initialize state
			const isCollapsed = localStorage.getItem(STORAGE_KEY) === 'true';
			if (isCollapsed) {
				sidebar?.setAttribute('data-collapsed', 'true');
			}

			// Toggle handler
			sidebarToggle?.addEventListener('click', () => {
				const currentCollapsed = sidebar?.getAttribute('data-collapsed') === 'true';
				const newState = !currentCollapsed;
				
				if (newState) {
					sidebar?.setAttribute('data-collapsed', 'true');
				} else {
					sidebar?.removeAttribute('data-collapsed');
				}
				
				localStorage.setItem(STORAGE_KEY, String(newState));
			});
		</script>
	</body>
</html>

<style is:global>
	* {
		scrollbar-width: thin;
		scrollbar-color: var(--border-primary) transparent;
	}

	::-webkit-scrollbar {
		width: 6px;
	}

	::-webkit-scrollbar-track {
		background: transparent;
	}

	::-webkit-scrollbar-thumb {
		background: var(--border-primary);
		border-radius: 10px;
	}

	::-webkit-scrollbar-thumb:hover {
		background: var(--color-premium-accent);
	}
</style>
