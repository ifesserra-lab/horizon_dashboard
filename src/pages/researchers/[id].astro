---
import Layout from "../../layouts/Layout.astro";
import researchersData from "../../data/canonical/researchers_canonical.json";
import initiativesData from "../../data/canonical/initiatives_canonical.json";
import type { Researcher } from "../../types/researchers";

// Profile Components
import ResearcherProfileHeader from "../../components/researchers/ResearcherProfileHeader.astro";
import ResearcherProfileEducation from "../../components/researchers/ResearcherProfileEducation.astro";
import ResearcherProfileResume from "../../components/researchers/ResearcherProfileResume.astro";
import ResearcherProfileDashboard from "../../components/researchers/ResearcherProfileDashboard.astro";
import ResearcherProfileGroups from "../../components/researchers/ResearcherProfileGroups.astro";
import ResearcherProfileInitiatives from "../../components/researchers/ResearcherProfileInitiatives.astro";
import ResearcherProfileAdvisorships from "../../components/researchers/ResearcherProfileAdvisorships.astro";
import ResearcherProfileArticles from "../../components/researchers/ResearcherProfileArticles.astro";
import ResearcherProfileStats from "../../components/researchers/ResearcherProfileStats.astro";

export function getStaticPaths() {
    const researchers = researchersData as unknown as Researcher[];
    return researchers.map((researcher) => ({
        params: { id: researcher.id.toString() },
        props: { researcher },
    }));
}

interface Props {
    researcher: Researcher;
}

const { researcher } = Astro.props;

// Enrich initiatives with start_date from canonical source
const enrichedInitiatives = researcher.initiatives.map((init) => {
    const fullInit = (initiativesData as any[]).find((i) => i.id === init.id);
    return {
        ...init,
        start_date: fullInit?.start_date,
        end_date: fullInit?.end_date,
        initiative_type: fullInit?.initiative_type,
    };
});

// Update researcher object with enriched initiatives
const enrichedResearcher = {
    ...researcher,
    initiatives: enrichedInitiatives,
};
---

<Layout
    title={researcher.name}
    breadcrumbReplacements={{ [researcher.id]: researcher.name }}
>
    <nav class="mb-8" aria-label="Navegação secundária">
        <!-- Back button removed -->
    </nav>

    <div class="flex flex-col lg:flex-row gap-8 items-start">
        <div class="flex-1 space-y-8 w-full">
            <ResearcherProfileHeader researcher={enrichedResearcher} />
            <ResearcherProfileResume researcher={enrichedResearcher} />

            <ResearcherProfileStats
                totalArticles={enrichedResearcher.articles.length}
                totalProjects={enrichedResearcher.initiatives.length}
                totalAdvisorships={researcher.advisorships?.length || 0}
            />

            <ResearcherProfileDashboard
                researcher={enrichedResearcher}
                advisorships={researcher.advisorships || []}
            />

            <ResearcherProfileEducation researcher={enrichedResearcher} />
            <ResearcherProfileGroups researcher={enrichedResearcher} />
            <ResearcherProfileInitiatives researcher={enrichedResearcher} />
            <ResearcherProfileAdvisorships
                advisorships={researcher.advisorships || []}
            />

            <ResearcherProfileArticles researcher={enrichedResearcher} />
        </div>
    </div>
</Layout>
