---

---

<div class="relative inline-block accessibility-menu-container">
  <button
    type="button"
    class="accessibility-toggle-btn p-3 rounded-xl bg-border-main hover:bg-premium-accent/10 hover:text-premium-accent transition-all duration-300 group"
    aria-label="Opções de acessibilidade"
    aria-expanded="false"
    aria-haspopup="true"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="w-5 h-5"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      aria-hidden="true"
    >
      <circle cx="12" cy="12" r="10"></circle>
      <circle cx="12" cy="12" r="3"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </button>

  <div
    class="accessibility-dropdown absolute right-0 mt-2 w-72 glass-card p-0 hidden z-50 shadow-2xl origin-top-right transition-all duration-200 opacity-0 scale-95 overflow-hidden"
    role="dialog"
    aria-label="Painel de Acessibilidade"
    aria-modal="false"
  >
    <!-- Header -->
    <div
      class="flex items-center justify-between px-4 py-3 border-b border-border-main"
    >
      <h2 class="text-sm font-bold uppercase tracking-wider">Acessibilidade</h2>
      <button
        class="accessibility-close-btn p-1 hover:bg-premium-accent/10 rounded-lg transition-colors"
        aria-label="Fechar painel de acessibilidade"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="p-4 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto">
      <!-- Theme Section -->
      <div>
        <p
          class="text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2 flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
          Tema
        </p>
        <div class="grid grid-cols-3 gap-2">
          <button
            id="theme-light"
            class="theme-btn p-3 rounded-xl text-xs font-medium transition-all border-2 border-transparent hover:border-premium-accent/50 flex flex-col items-center gap-1"
            data-theme="light"
            title="Modo Claro"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <span>Claro</span>
          </button>
          <button
            id="theme-dark"
            class="theme-btn p-3 rounded-xl text-xs font-medium transition-all border-2 border-transparent hover:border-premium-accent/50 flex flex-col items-center gap-1"
            data-theme="dark"
            title="Modo Escuro"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
            <span>Escuro</span>
          </button>
          <button
            id="theme-auto"
            class="theme-btn p-3 rounded-xl text-xs font-medium transition-all border-2 border-transparent hover:border-premium-accent/50 flex flex-col items-center gap-1"
            data-theme="auto"
            title="Automático (Sistema)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
              <line x1="8" y1="21" x2="16" y2="21"></line>
              <line x1="12" y1="17" x2="12" y2="21"></line>
            </svg>
            <span>Auto</span>
          </button>
        </div>
      </div>

      <div class="h-px bg-border-main"></div>

      <!-- Contrast Section -->
      <div>
        <p
          class="text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2 flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 2v20"></path>
          </svg>
          Contraste
        </p>
        <div class="grid grid-cols-3 gap-2">
          <button
            id="contrast-normal"
            class="contrast-btn p-3 rounded-xl text-xs font-medium transition-all border-2 border-transparent hover:border-premium-accent/50"
            data-contrast="normal"
            title="Contraste Normal"
          >
            Normal
          </button>
          <button
            id="contrast-high"
            class="contrast-btn p-3 rounded-xl text-xs font-medium transition-all border-2 border-transparent hover:border-premium-accent/50"
            data-contrast="high"
            title="Alto Contraste"
          >
            Alto
          </button>
          <button
            id="contrast-maximum"
            class="contrast-btn p-3 rounded-xl text-xs font-medium transition-all border-2 border-transparent hover:border-premium-accent/50"
            data-contrast="maximum"
            title="Contraste Máximo"
          >
            Máximo
          </button>
        </div>
      </div>

      <div class="h-px bg-border-main"></div>

      <!-- Font Size Section -->
      <div>
        <p
          class="text-[10px] font-bold uppercase tracking-wider text-text-muted mb-2 flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="4 7 4 4 20 4 20 7"></polyline>
            <line x1="9" y1="20" x2="15" y2="20"></line>
            <line x1="12" y1="4" x2="12" y2="20"></line>
          </svg>
          Tamanho da Fonte
        </p>
        <div class="grid grid-cols-4 gap-2">
          <button
            id="size-sm"
            class="size-btn p-3 rounded-xl text-[10px] font-bold transition-all border-2 border-transparent hover:border-premium-accent/50"
            data-size="sm"
            title="Pequena (87.5%)"
          >
            A
          </button>
          <button
            id="size-base"
            class="size-btn p-3 rounded-xl text-xs font-bold transition-all border-2 border-transparent hover:border-premium-accent/50"
            data-size="base"
            title="Normal (100%)"
          >
            A
          </button>
          <button
            id="size-lg"
            class="size-btn p-3 rounded-xl text-base font-bold transition-all border-2 border-transparent hover:border-premium-accent/50"
            data-size="lg"
            title="Grande (125%)"
          >
            A
          </button>
          <button
            id="size-xl"
            class="size-btn p-3 rounded-xl text-xl font-bold transition-all border-2 border-transparent hover:border-premium-accent/50"
            data-size="xl"
            title="Extra (175%)"
          >
            A
          </button>
        </div>
      </div>

      <div class="h-px bg-border-main"></div>

      <!-- Additional Options -->
      <div>
        <p
          class="text-[10px] font-bold uppercase tracking-wider text-text-muted mb-3 flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-3 h-3"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6"></path>
            <path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24"></path>
            <path d="M1 12h6m6 0h6"></path>
            <path d="m4.93 19.07 4.24-4.24m5.66-5.66 4.24-4.24"></path>
          </svg>
          Opções Adicionais
        </p>
        <div class="space-y-2">
          <!-- Reduce Motion -->
          <label
            class="flex items-start gap-3 p-2 rounded-lg hover:bg-premium-accent/5 cursor-pointer transition-colors"
          >
            <input
              type="checkbox"
              id="option-reduce-motion"
              class="option-toggle mt-1 w-4 h-4 rounded border-border-main text-premium-accent focus:ring-premium-accent focus:ring-2 cursor-pointer"
            />
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-4 h-4 text-text-muted"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
                  ></path>
                  <path d="M21 3v5h-5"></path>
                </svg>
                <span class="text-xs font-medium">Reduzir Movimento</span>
              </div>
              <p class="text-[10px] text-text-muted mt-0.5">
                Minimiza animações e transições
              </p>
            </div>
          </label>

          <!-- Enhanced Focus -->
          <label
            class="flex items-start gap-3 p-2 rounded-lg hover:bg-premium-accent/5 cursor-pointer transition-colors"
          >
            <input
              type="checkbox"
              id="option-enhanced-focus"
              class="option-toggle mt-1 w-4 h-4 rounded border-border-main text-premium-accent focus:ring-premium-accent focus:ring-2 cursor-pointer"
            />
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-4 h-4 text-text-muted"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                <span class="text-xs font-medium">Indicadores de Foco</span>
              </div>
              <p class="text-[10px] text-text-muted mt-0.5">
                Destaca elementos focados
              </p>
            </div>
          </label>

          <!-- Screen Reader -->
          <label
            class="flex items-start gap-3 p-2 rounded-lg hover:bg-premium-accent/5 cursor-pointer transition-colors"
          >
            <input
              type="checkbox"
              id="option-screen-reader"
              class="option-toggle mt-1 w-4 h-4 rounded border-border-main text-premium-accent focus:ring-premium-accent focus:ring-2 cursor-pointer"
            />
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-4 h-4 text-text-muted"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                  <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
                <span class="text-xs font-medium"
                  >Otimizar para Leitor de Tela</span
                >
              </div>
              <p class="text-[10px] text-text-muted mt-0.5">
                Melhora compatibilidade com leitores de tela
              </p>
            </div>
          </label>
        </div>
      </div>

      <div class="h-px bg-border-main"></div>

      <!-- Restore Defaults Button -->
      <button
        id="restore-defaults-btn"
        class="w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl text-sm font-medium bg-border-main hover:bg-premium-accent/10 hover:text-premium-accent transition-all"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-4 h-4"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
          <path d="M21 3v5h-5"></path>
          <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path>
          <path d="M21 21v-5h-5"></path>
        </svg>
        Restaurar Padrões
      </button>
    </div>
  </div>
</div>

<script>
  const containers = document.querySelectorAll(".accessibility-menu-container");

  containers.forEach((container) => {
    const btn = container.querySelector(
      ".accessibility-toggle-btn",
    ) as HTMLButtonElement;
    const closeBtn = container.querySelector(
      ".accessibility-close-btn",
    ) as HTMLButtonElement;
    const dropdown = container.querySelector(
      ".accessibility-dropdown",
    ) as HTMLDivElement;

    // Theme buttons
    const themeBtns = container.querySelectorAll(".theme-btn");
    // Contrast buttons
    const contrastBtns = container.querySelectorAll(".contrast-btn");
    // Size buttons
    const sizeBtns = container.querySelectorAll(".size-btn");
    // Option toggles
    const reduceMotionToggle = container.querySelector(
      "#option-reduce-motion",
    ) as HTMLInputElement;
    const enhancedFocusToggle = container.querySelector(
      "#option-enhanced-focus",
    ) as HTMLInputElement;
    const screenReaderToggle = container.querySelector(
      "#option-screen-reader",
    ) as HTMLInputElement;
    // Restore button
    const restoreBtn = container.querySelector(
      "#restore-defaults-btn",
    ) as HTMLButtonElement;

    const toggleDropdown = () => {
      const isHidden = dropdown.classList.contains("hidden");
      if (isHidden) {
        dropdown.classList.remove("hidden");
        setTimeout(() => {
          dropdown.classList.remove("opacity-0", "scale-95");
          dropdown.classList.add("opacity-100", "scale-100");
        }, 10);
        btn.setAttribute("aria-expanded", "true");
      } else {
        dropdown.classList.add("opacity-0", "scale-95");
        dropdown.classList.remove("opacity-100", "scale-100");
        setTimeout(() => dropdown.classList.add("hidden"), 200);
        btn.setAttribute("aria-expanded", "false");
      }
    };

    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleDropdown();
    });

    closeBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleDropdown();
    });

    document.addEventListener("click", (e) => {
      if (
        !dropdown.classList.contains("hidden") &&
        !container.contains(e.target as Node)
      ) {
        toggleDropdown();
      }
    });

    // ESC to close
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !dropdown.classList.contains("hidden")) {
        toggleDropdown();
      }
    });

    const updateUI = () => {
      // Theme
      const themePreference =
        localStorage.getItem("theme-preference") || "auto";
      themeBtns.forEach((themeBtn) => {
        const btn = themeBtn as HTMLButtonElement;
        const isActive = btn.dataset.theme === themePreference;
        btn.classList.toggle("bg-premium-accent/20", isActive);
        btn.classList.toggle("text-premium-accent", isActive);
        btn.classList.toggle("border-premium-accent", isActive);
      });

      // Contrast
      const contrast = localStorage.getItem("contrast") || "normal";
      contrastBtns.forEach((contrastBtn) => {
        const btn = contrastBtn as HTMLButtonElement;
        const isActive = btn.dataset.contrast === contrast;
        btn.classList.toggle("bg-premium-accent/20", isActive);
        btn.classList.toggle("text-premium-accent", isActive);
        btn.classList.toggle("border-premium-accent", isActive);
      });

      // Font Size
      const textScale = localStorage.getItem("text-scale") || "base";
      sizeBtns.forEach((sizeBtn) => {
        const btn = sizeBtn as HTMLButtonElement;
        const isActive = btn.dataset.size === textScale;
        btn.classList.toggle("bg-premium-accent/20", isActive);
        btn.classList.toggle("text-premium-accent", isActive);
        btn.classList.toggle("border-premium-accent", isActive);
      });

      // Toggles
      if (reduceMotionToggle) {
        reduceMotionToggle.checked =
          localStorage.getItem("reduce-motion") === "true";
      }
      if (enhancedFocusToggle) {
        enhancedFocusToggle.checked =
          localStorage.getItem("enhanced-focus") === "true";
      }
      if (screenReaderToggle) {
        screenReaderToggle.checked =
          localStorage.getItem("screen-reader-optimized") === "true";
      }
    };

    const applySettings = () => {
      // Theme
      const themePreference =
        localStorage.getItem("theme-preference") || "auto";
      let theme = themePreference;
      if (theme === "auto") {
        theme = window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "light";
      }
      document.documentElement.classList.toggle("dark", theme === "dark");
      localStorage.setItem("theme", theme);

      // Contrast
      const contrast = localStorage.getItem("contrast") || "normal";
      document.documentElement.classList.remove(
        "contrast-high",
        "contrast-maximum",
      );
      if (contrast === "high") {
        document.documentElement.classList.add("contrast-high");
      } else if (contrast === "maximum") {
        document.documentElement.classList.add("contrast-maximum");
      }

      // Font Scale
      const textScale = localStorage.getItem("text-scale") || "base";
      const scales = ["sm", "base", "lg", "xl"];
      scales.forEach((s) => {
        document.documentElement.classList.toggle(
          `text-scale-${s}`,
          textScale === s,
        );
      });

      // Additional Options
      document.documentElement.classList.toggle(
        "reduce-motion",
        localStorage.getItem("reduce-motion") === "true",
      );
      document.documentElement.classList.toggle(
        "enhanced-focus",
        localStorage.getItem("enhanced-focus") === "true",
      );
      document.documentElement.classList.toggle(
        "screen-reader-optimized",
        localStorage.getItem("screen-reader-optimized") === "true",
      );
    };

    // Theme buttons
    themeBtns.forEach((themeBtn) => {
      themeBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const btn = themeBtn as HTMLButtonElement;
        localStorage.setItem("theme-preference", btn.dataset.theme!);
        applySettings();
        updateUI();
      });
    });

    // Contrast buttons
    contrastBtns.forEach((contrastBtn) => {
      contrastBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const btn = contrastBtn as HTMLButtonElement;
        localStorage.setItem("contrast", btn.dataset.contrast!);
        applySettings();
        updateUI();
      });
    });

    // Size buttons
    sizeBtns.forEach((sizeBtn) => {
      sizeBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        const btn = sizeBtn as HTMLButtonElement;
        localStorage.setItem("text-scale", btn.dataset.size!);
        applySettings();
        updateUI();
      });
    });

    // Option toggles
    reduceMotionToggle?.addEventListener("change", () => {
      localStorage.setItem(
        "reduce-motion",
        reduceMotionToggle.checked.toString(),
      );
      applySettings();
    });

    enhancedFocusToggle?.addEventListener("change", () => {
      localStorage.setItem(
        "enhanced-focus",
        enhancedFocusToggle.checked.toString(),
      );
      applySettings();
    });

    screenReaderToggle?.addEventListener("change", () => {
      localStorage.setItem(
        "screen-reader-optimized",
        screenReaderToggle.checked.toString(),
      );
      applySettings();
    });

    // Restore Defaults
    restoreBtn?.addEventListener("click", (e) => {
      e.stopPropagation();
      const defaults = {
        "theme-preference": "auto",
        contrast: "normal",
        "text-scale": "base",
        "reduce-motion": "false",
        "enhanced-focus": "false",
        "screen-reader-optimized": "false",
      };

      Object.entries(defaults).forEach(([key, value]) => {
        localStorage.setItem(key, value);
      });

      applySettings();
      updateUI();

      // Visual feedback
      restoreBtn.classList.add("scale-95");
      setTimeout(() => restoreBtn.classList.remove("scale-95"), 150);
    });

    // Initialize
    updateUI();
  });
</script>
