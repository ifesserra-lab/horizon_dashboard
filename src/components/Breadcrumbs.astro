---
const { pathname } = Astro.url;
const baseUrlSegment = import.meta.env.BASE_URL.replace(/^\/|\/$/g, '');
const rawSegments = pathname.split('/').filter(Boolean);

// Filter out base path segment (case-insensitive)
const paths = rawSegments.filter(segment => {
  const lowerSeg = segment.toLowerCase();
  const lowerBase = baseUrlSegment.toLowerCase();
  
  // Remove if matches configured base
  if (lowerBase.length > 0 && lowerSeg === lowerBase) return false;
  
  // Remove if matches project name explicitly (safety net for GitHub Pages)
  if (lowerSeg === 'horizon_dashboard') return false;
  
  return true;
});

interface Props {
  replacements?: Record<string, string>;
}

const { replacements = {} } = Astro.props;

const breadcrumbs = paths.map((path, index) => {
  const pathParts = paths.slice(0, index + 1);
  const url = `${import.meta.env.BASE_URL}${pathParts.join('/')}`;
  
  let label = path;
  if (replacements[path]) {
    label = replacements[path];
  } else if (path === 'groups') {
    label = 'Grupos';
  } else if (path === 'projects') {
    label = 'Projetos';
  } else if (path === 'knowledge-areas') {
    label = 'Ãreas';
  } else {
    // Increase truncation limit slightly for better readability
    label = path.length > 20 ? path.substring(0, 20) + '...' : path;
  }
  
  return { label, url };
});
---

<nav aria-label="Breadcrumb" class="flex mb-6">
  <ol class="flex items-center space-x-2 text-xs font-medium text-text-secondary">
    <li class="flex items-center">
      <a href={import.meta.env.BASE_URL} class="hover:text-premium-accent transition-colors flex items-center gap-1">
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Home
      </a>
    </li>
    {breadcrumbs.map((crumb, index) => (
      <li class="flex items-center space-x-2">
        <svg aria-hidden="true" class="w-3 h-3 text-slate-400" fill="none" viewBox="0 0 10 10" stroke="currentColor" stroke-width="2"><path d="M1 9l4-4-4-4"/></svg>
        <a 
          href={crumb.url} 
          class={`hover:text-premium-accent transition-colors capitalize ${index === breadcrumbs.length - 1 ? 'text-premium-accent font-bold pointer-events-none' : ''}`}
          aria-current={index === breadcrumbs.length - 1 ? 'page' : undefined}
        >
          {crumb.label}
        </a>
      </li>
    ))}
  </ol>
</nav>
